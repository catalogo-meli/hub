<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catálogo | HUB</title>
  <style>
    :root{
      --bg0:#070b16; --bg1:#0b1224; --card:#0f1933; --card2:#0c152c;
      --txt:#e7ecff; --muted:#9fb0d0; --line:rgba(255,255,255,.08);
      --pri:#3b82f6; --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444;
      --chip:#14234a;
      --shadow: 0 12px 36px rgba(0,0,0,.35);
      --radius:16px;
      --input:#0b1430;
    }
    [data-theme="light"]{
      --bg0:#f6f8ff; --bg1:#ffffff; --card:#ffffff; --card2:#f2f5ff;
      --txt:#0b1224; --muted:#51627d; --line:rgba(15,23,42,.12);
      --chip:#eef2ff;
      --input:#ffffff;
      --shadow: 0 12px 36px rgba(15,23,42,.10);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1200px 700px at 25% -10%, rgba(59,130,246,.22) 0%, transparent 60%),
        radial-gradient(900px 600px at 90% 0%, rgba(168,85,247,.18) 0%, transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color:var(--txt);
      min-height:100vh;
    }
    .wrap{max-width:1200px;margin:0 auto;padding:26px 18px 80px}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:10px 6px 18px;
    }
    .brand h1{margin:0;font-size:44px;letter-spacing:-.6px}
    .brand p{margin:4px 0 0;color:var(--muted)}
    .top-actions{display:flex;gap:10px;align-items:center}
    .btn{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      color:var(--txt);
      padding:10px 14px;border-radius:12px;
      cursor:pointer;
    }
    .btn.primary{background:linear-gradient(180deg, rgba(59,130,246,.9), rgba(59,130,246,.6));border-color:rgba(59,130,246,.35)}
    .btn.ok{background:linear-gradient(180deg, rgba(34,197,94,.85), rgba(34,197,94,.55));border-color:rgba(34,197,94,.35)}
    .btn.ghost{background:transparent}
    .btn:disabled{opacity:.55;cursor:not-allowed}

    .icon-btn{
      width:42px;height:42px;display:flex;align-items:center;justify-content:center;
      padding:0;border-radius:14px;
      font-size:18px;
    }

    .tabs{
      display:flex;gap:8px;flex-wrap:wrap;
      padding:8px;
      background:rgba(255,255,255,.03);
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow:var(--shadow);
    }
    .tab{
      padding:10px 12px;border-radius:14px;
      border:1px solid transparent;
      color:var(--muted);
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      background:rgba(59,130,246,.16);
      border-color:rgba(59,130,246,.22);
      color:var(--txt);
    }

    .grid{display:grid;gap:14px;margin-top:16px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    [data-theme="light"] .card{
      background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.88));
    }
    .card h2{margin:0 0 8px;font-size:18px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .spacer{flex:1}
    .hr{height:1px;background:var(--line);margin:14px 0}
    .pill{
      display:inline-flex;gap:8px;align-items:center;
      padding:7px 10px;border-radius:999px;
      background:rgba(255,255,255,.05);
      border:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
    }
    .pill b{color:var(--txt);font-weight:600}

    .input, select, textarea{
      width:100%;
      background:var(--input);
      color:var(--txt);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
    }
    textarea{min-height:86px;resize:vertical}
    select option{
      background: var(--bg1);
      color: var(--txt);
    }

    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border:1px solid var(--line);
      border-radius:14px;
    }
    .table th,.table td{
      text-align:left;
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      vertical-align:top;
      font-size:13px;
    }
    .table th{color:var(--muted);font-weight:600;background:rgba(255,255,255,.03)}
    .table tr:last-child td{border-bottom:none}
    .right{text-align:right}
    .nowrap{white-space:nowrap}

    .toast{
      position:fixed;right:18px;bottom:18px;
      background:rgba(15,23,42,.92);
      border:1px solid rgba(255,255,255,.10);
      color:#fff;
      padding:10px 12px;
      border-radius:14px;
      box-shadow:var(--shadow);
      display:none;
      max-width:min(520px, calc(100vw - 36px));
      z-index:50;
    }
    [data-theme="light"] .toast{background:rgba(10,20,40,.92)}
    .toast.show{display:block}
    .toast .t1{font-weight:700}
    .toast .t2{margin-top:2px;opacity:.9;font-size:13px}

    .errbar{
      display:none;
      margin-top:14px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(239,68,68,.25);
      background:rgba(239,68,68,.10);
      color:#ffd4d4;
    }
    .errbar.show{display:block}

    .kpis{display:grid;grid-template-columns:repeat(4, minmax(0,1fr));gap:12px}
    @media (max-width:900px){.kpis{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:520px){.kpis{grid-template-columns:1fr}}
    .kpi{
      padding:14px;border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
    }
    .kpi .v{font-size:26px;font-weight:800;letter-spacing:-.5px}
    .kpi .l{color:var(--muted);font-size:12px;margin-top:2px}

    /* MultiSelect */
    .ms{ position:relative; min-width:260px; }
    .ms-btn{
      display:flex;gap:10px;align-items:center;justify-content:space-between;
      padding:10px 12px;border-radius:12px;
      border:1px solid var(--line);
      background:var(--input);
      cursor:pointer;
      user-select:none;
    }
    .ms-btn .label{color:var(--muted);font-size:12px}
    .ms-btn .value{font-weight:600}
    .ms-panel{
      position:absolute;left:0;right:0;top:calc(100% + 8px);
      background:var(--bg1);
      border:1px solid var(--line);
      border-radius:14px;
      box-shadow:var(--shadow);
      padding:10px;
      display:none;
      z-index:10;
      max-height:280px;
      overflow:auto;
    }
    .ms.open .ms-panel{display:block}
    .ms-item{display:flex;gap:10px;align-items:center;padding:8px 6px;border-radius:10px}
    .ms-item:hover{background:rgba(255,255,255,.04)}
    .ms-item input{width:auto}
    .ms-actions{display:flex;gap:8px;padding:8px 6px;border-top:1px solid var(--line);margin-top:8px}
    .ms-actions button{flex:1}

    /* Search with clear */
    .search{ position:relative; min-width:260px; flex:1; }
    .search input{padding-right:40px}
    .search .x{
      position:absolute;right:10px;top:50%;transform:translateY(-50%);
      width:26px;height:26px;border-radius:10px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--muted);
      cursor:pointer;
      display:none;
      align-items:center;justify-content:center;
      user-select:none;
    }
    .search.has .x{display:flex}

    .copyable{cursor:pointer}
    .copyable:hover{opacity:.85;text-decoration:underline}

    .badge{
      display:inline-flex;align-items:center;gap:6px;
      padding:4px 8px;border-radius:999px;
      font-size:12px;border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--muted);
    }
    .badge.ok{border-color:rgba(34,197,94,.25);background:rgba(34,197,94,.10);color:#c8ffe0}
    .badge.bad{border-color:rgba(239,68,68,.25);background:rgba(239,68,68,.10);color:#ffd4d4}
    [data-theme="light"] .badge.ok{color:#0f5132}
    [data-theme="light"] .badge.bad{color:#842029}

    .flow-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(260px, 1fr));
      gap:12px;
    }
    .flow-col{
      border:1px solid var(--line);
      border-radius:14px;
      background:rgba(255,255,255,.03);
      padding:12px;
    }
    .flow-col h3{margin:0 0 10px;font-size:14px;display:flex;align-items:center;justify-content:space-between;gap:10px}
    .flow-col ul{margin:0;padding-left:16px;color:var(--muted)}
    .flow-col li{margin:6px 0}
    .feriado{
      outline:2px solid rgba(245,158,11,.22);
      background:rgba(245,158,11,.08) !important;
    }

    /* Inline delete X */
    .xbtn{
      width:30px;height:30px;border-radius:10px;
      display:inline-flex;align-items:center;justify-content:center;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--muted);
      cursor:pointer;
    }
    .xbtn:hover{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.25);color:#ffd4d4}
    [data-theme="light"] .xbtn:hover{color:#842029}

    .smallnum{
      max-width:90px;
      text-align:right;
      padding-right:10px;
    }

    .lic{
      outline:2px solid rgba(239,68,68,.18);
      background:rgba(239,68,68,.10) !important;
      font-weight:700;
    }
    [data-theme="light"] .lic{
      background:rgba(239,68,68,.08) !important;
      color:#842029;
    }

    th.sortable{cursor:pointer; user-select:none}
    th.sortable:hover{opacity:.9}
    th.sortable .srt{margin-left:6px;opacity:.7;font-size:12px}
    .selbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .selbar .btn{padding:9px 12px}
  </style>
</head>

<body>
  <div class="wrap" id="appRoot">
    <header>
      <div class="brand">
        <h1>Catálogo</h1>
        <p>HUB Equipo &amp; Planificación</p>
      </div>
      <div class="top-actions">
        <button class="btn ghost icon-btn" id="btnTheme" title="Cambiar tema">☾</button>
      </div>
    </header>

    <div id="errBar" class="errbar"></div>

    <nav class="tabs" id="tabs">
      <div class="tab active" data-tab="dashboard">Dashboard</div>
      <div class="tab" data-tab="daily">Operativa diaria</div>
      <div class="tab" data-tab="colabs">Colaboradores</div>
      <div class="tab" data-tab="habil">Habilitaciones</div>
      <div class="tab" data-tab="pres">Presentismo</div>
    </nav>

    <main class="grid" style="margin-top:16px">
      <!-- Dashboard -->
      <section class="card" id="tab_dashboard">
        <div class="row">
          <div>
            <h2>Dashboard</h2>
            <div class="muted">Indicadores rápidos.</div>
          </div>
          <div class="spacer"></div>
          <button class="btn" id="btnReloadDash">Actualizar</button>
        </div>

        <div class="hr"></div>

        <div class="kpis" id="dashKpis"></div>

        <div class="hr"></div>

        <div class="row">
          <div class="pill"><b>Distribución</b> por rol</div>
        </div>
        <div style="margin-top:12px;overflow:auto">
          <table class="table" id="tblDashRoles">
            <thead><tr><th>Rol</th><th class="right">Cantidad</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Operativa diaria -->
      <section class="card" id="tab_daily" style="display:none">
        <div class="row">
          <div>
            <h2>Operativa diaria</h2>
            <div class="muted">Configuración de flujos + planificación + Slack.</div>
          </div>
          <div class="spacer"></div>
          <button class="btn primary" id="btnGenerarPlan">Generar planificación</button>
        </div>

        <div class="hr"></div>

        <div class="row">
          <div class="pill"><b>Flujos</b> (perfiles requeridos)</div>
          <div class="spacer"></div>
          <div class="pill" id="dailyStatus">Listo</div>
        </div>

        <div style="margin-top:10px;overflow:auto">
          <table class="table" id="tblFlujos">
            <thead>
              <tr>
                <th>Flujo</th>
                <th class="right nowrap">Perfiles requeridos</th>
                <th class="right nowrap">Acciones</th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr>
                <td style="min-width:240px">
                  <input class="input" id="newFlujoName" placeholder="+ Nuevo flujo..." />
                </td>
                <td class="right nowrap" style="min-width:140px">
                  <input class="input smallnum" id="newFlujoReq" type="number" min="0" step="1" placeholder="Req." />
                </td>
                <td class="right nowrap" style="min-width:140px">
                  <button class="btn primary" id="btnAddFlujo">Agregar</button>
                </td>
              </tr>
            </tfoot>
          </table>
        </div>

        <div class="hr"></div>

        <h2 style="margin-top:0">Planificación (resultado)</h2>
        <div class="muted">Visualización por flujo (columnas). Botón para generar mensaje por flujo.</div>
        <div style="margin-top:12px" id="planGrid" class="flow-grid"></div>

        <div class="hr"></div>

        <h2 style="margin-top:0">Slack Outbox (pendientes)</h2>
        <div class="muted">Guardado automático de cambios. Envío por fila.</div>
        <div style="margin-top:12px;overflow:auto">
          <table class="table" id="tblOutbox">
            <thead>
              <tr>
                <th class="nowrap">Fecha</th>
                <th style="min-width:220px">Canal</th>
                <th>Mensaje</th>
                <th class="nowrap">Estado</th>
                <th class="right nowrap">Acción</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Colaboradores -->
      <section class="card" id="tab_colabs" style="display:none">
        <div class="row">
          <div>
            <h2>Colaboradores</h2>
            <div class="muted">Filtrá por rol/equipo y buscá por nombre, ID o mail.</div>
          </div>
          <div class="spacer"></div>
          <button class="btn" id="btnReloadColabs">Actualizar</button>
        </div>

        <div class="hr"></div>

        <div class="row">
          <div class="ms" id="msRolesColabs"></div>
          <div class="ms" id="msEquiposColabs"></div>
          <div class="search" id="searchColabsWrap">
            <input class="input" id="searchColabs" placeholder="Buscar..." />
            <div class="x" id="clearSearchColabs">×</div>
          </div>
          <button class="btn ghost" id="btnClearColabs">Limpiar</button>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="pill" id="colabsSelPill"><b>Seleccionados</b> 0</div>
          <div class="spacer"></div>
          <div class="selbar">
            <button class="btn" id="btnCopySelIds">Copiar IDs</button>
            <button class="btn" id="btnCopySelMailProd">Copiar Mail Productora</button>
            <button class="btn" id="btnCopySelMailExt">Copiar Mail Externo</button>
            <button class="btn ghost" id="btnClearSelColabs">Limpiar selección</button>
          </div>
        </div>

        <div style="margin-top:12px;overflow:auto">
          <table class="table" id="tblColabs">
            <thead>
              <tr>
                <th class="nowrap"><input type="checkbox" id="colabsSelectAll" /></th>
                <th class="sortable" data-sort="id">ID_MELI<span class="srt" data-srt="id"></span></th>
                <th class="sortable" data-sort="nombre">Nombre<span class="srt" data-srt="nombre"></span></th>
                <th class="sortable" data-sort="rol">Rol<span class="srt" data-srt="rol"></span></th>
                <th class="sortable" data-sort="equipo">Equipo<span class="srt" data-srt="equipo"></span></th>
                <th class="sortable" data-sort="ubic">Ubicación<span class="srt" data-srt="ubic"></span></th>
                <th class="sortable" data-sort="mailProd">Mail Productora<span class="srt" data-srt="mailProd"></span></th>
                <th class="sortable" data-sort="mailExt">Mail Externo<span class="srt" data-srt="mailExt"></span></th>
                <th class="sortable nowrap" data-sort="ingreso">Fecha Ingreso<span class="srt" data-srt="ingreso"></span></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="muted" style="margin-top:10px">Tip: podés seleccionar varias filas y copiar IDs o mails en bloque. También podés clickear un ID/mail para copiarlo individualmente.</div>
      </section>

      <!-- Habilitaciones -->
      <section class="card" id="tab_habil" style="display:none">
        <div class="row">
          <div>
            <h2>Habilitaciones</h2>
            <div class="muted">Habilitar / Fijo por usuario y flujo.</div>
          </div>
          <div class="spacer"></div>
          <button class="btn" id="btnReloadHabil">Actualizar</button>
        </div>

        <div class="hr"></div>

        <div class="row">
          <div class="ms" id="msRolesHabil"></div>
          <div class="ms" id="msEquiposHabil"></div>
          <div class="search" id="searchHabilWrap">
            <input class="input" id="searchHabil" placeholder="Buscar..." />
            <div class="x" id="clearSearchHabil">×</div>
          </div>
          <button class="btn ghost" id="btnClearHabil">Limpiar</button>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="pill"><b>Referencia</b> H = Habilitado | F = Fijo</div>
        </div>

        <div style="margin-top:12px;overflow:auto">
          <table class="table" id="tblHabil">
            <thead id="tblHabilHead"></thead>
            <tbody id="tblHabilBody"></tbody>
          </table>
        </div>
      </section>

      <!-- Presentismo -->
      <section class="card" id="tab_pres" style="display:none">
        <div class="row">
          <div>
            <h2>Presentismo</h2>
            <div class="muted">Semana (Lun–Vie). Feriados destacados. Licencias con rango.</div>
          </div>
          <div class="spacer"></div>
          <button class="btn" id="btnReloadPres">Actualizar</button>
        </div>

        <div class="hr"></div>

        <div class="row">
          <div class="ms" id="msRolesPres"></div>
          <div class="ms" id="msEquiposPres"></div>
          <div class="search" id="searchPresWrap">
            <input class="input" id="searchPres" placeholder="Buscar..." />
            <div class="x" id="clearSearchPres">×</div>
          </div>
          <button class="btn ghost" id="btnClearPres">Limpiar</button>
        </div>

        <div class="hr"></div>

        <div class="row" style="align-items:flex-end">
          <div style="min-width:260px">
            <div class="muted" style="font-size:12px;margin-bottom:6px">Colaborador</div>
            <select id="presSelectColab"></select>
          </div>

          <div style="max-width:220px">
            <div class="muted" style="font-size:12px;margin-bottom:6px">Tipo</div>
            <select id="presTipo">
              <option value="AI">AI - Ausencia injustificada</option>
              <option value="E">E - Día de estudio</option>
              <option value="M">M - Licencia médica</option>
              <option value="MM">MM - Menor a cargo</option>
              <option value="V">V - Vacaciones</option>
            </select>
          </div>

          <div style="max-width:220px">
            <div class="muted" style="font-size:12px;margin-bottom:6px">Desde</div>
            <input class="input" id="presDesde" type="date" />
          </div>

          <div style="max-width:220px">
            <div class="muted" style="font-size:12px;margin-bottom:6px">Hasta</div>
            <input class="input" id="presHasta" type="date" />
          </div>

          <button class="btn primary" id="btnSetLicencia">Guardar</button>
        </div>

        <div class="hr"></div>

        <div style="overflow:auto">
          <table class="table" id="tblPresWeek">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </main>

    <div class="toast" id="toast">
      <div class="t1" id="toastT1"></div>
      <div class="t2" id="toastT2"></div>
    </div>
  </div>

  <script type="module" src="/api.js"></script>
  <script type="module" src="/app.js"></script>
</body>
</html>
